# æ™ºèƒ½è¡Œæç›‘æ§ç³»ç»Ÿ - æ¨¡å—åŒ–ç‰ˆæœ¬

## ğŸ“ é¡¹ç›®ç»“æ„

```
IntelligentLuggageMonitor/
â”œâ”€â”€ config.py              # é…ç½®æ–‡ä»¶ï¼ˆæ‰€æœ‰å‚æ•°ï¼‰
â”œâ”€â”€ utils.py              # å·¥å…·å‡½æ•°ï¼ˆbboxå¤„ç†ã€å¹³æ»‘ç­‰ï¼‰
â”œâ”€â”€ visualizer.py         # å¯è§†åŒ–æ¨¡å—ï¼ˆç»˜å›¾åŠŸèƒ½ï¼‰
â”œâ”€â”€ reid.py               # äººç‰©é‡è¯†åˆ«æ¨¡å—
â”œâ”€â”€ ownership.py          # è¡Œææ‰€æœ‰æƒè¿½è¸ªæ¨¡å—
â”œâ”€â”€ main.py               # ä¸»å…¥å£ç¨‹åºï¼ˆ300è¡Œï¼Œç®€æ´æ˜“è¯»ï¼‰
â”œâ”€â”€ step1_person_luggage_association.py  # åŸå§‹å®Œæ•´ä»£ç ï¼ˆ1042è¡Œï¼Œä¿ç•™ä½œä¸ºå¤‡ä»½ï¼‰
â””â”€â”€ trackers/
    â””â”€â”€ botsort_luggage.yaml
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ä½¿ç”¨æ¨¡å—åŒ–ç‰ˆæœ¬ï¼ˆæ¨èï¼‰
```bash
python main.py
```

### ä½¿ç”¨åŸå§‹ç‰ˆæœ¬
```bash
python step1_person_luggage_association.py
```

## ğŸ“ æ¨¡å—è¯´æ˜

### 1. config.py
- æ‰€æœ‰é…ç½®å‚æ•°é›†ä¸­ç®¡ç†
- æ–¹ä¾¿è°ƒæ•´é˜ˆå€¼å’Œå‚æ•°
- æ— éœ€æ·±å…¥ä»£ç ä¿®æ”¹

### 2. utils.py
- `parse_box()`: è§£æYOLOæ£€æµ‹æ¡†
- `center_from_bbox()`: è®¡ç®—ä¸­å¿ƒç‚¹
- `smooth_bbox()`: è¾¹ç•Œæ¡†å¹³æ»‘
- `overlay_mask()`: æ©ç å åŠ 

### 3. visualizer.py
- `draw_detection()`: ç»˜åˆ¶æ£€æµ‹ç»“æœ
- `draw_box_with_label()`: ç»˜åˆ¶è¾¹ç•Œæ¡†å’Œæ ‡ç­¾
- `draw_owner_connection()`: ç»˜åˆ¶æ‰€æœ‰è€…è¿çº¿

### 4. reid.py
- `extract_person_features()`: æå–äººç‰©ç‰¹å¾
- `compute_feature_similarity()`: è®¡ç®—ç›¸ä¼¼åº¦
- `match_person_reentry()`: åŒ¹é…é‡å…¥äººç‰©

### 5. ownership.py
- `calculate_dynamic_distance_threshold()`: åŠ¨æ€è·ç¦»é˜ˆå€¼
- `update_luggage_state()`: æ›´æ–°è¡Œææ‰€æœ‰æƒçŠ¶æ€

### 6. main.py
- `LuggageMonitor`: ä¸»ç›‘æ§ç±»
- æ•´åˆæ‰€æœ‰æ¨¡å—
- æ¸…æ™°çš„ä¸»å¾ªç¯é€»è¾‘

## ğŸ”§ è°ƒè¯•å»ºè®®

### 1. è°ƒæ•´æ£€æµ‹å‚æ•°
ç¼–è¾‘ `config.py`ï¼š
```python
CONF_THRES = 0.30          # é™ä½ä»¥æ£€æµ‹æ›´å¤šç‰©ä½“
MIN_CONSECUTIVE_FRAMES = 8  # æé«˜ä»¥è¿‡æ»¤æ›´å¤šè¯¯æ£€
```

### 2. å•ç‹¬æµ‹è¯•æ¨¡å—
```python
# æµ‹è¯•Re-IDæ¨¡å—
from reid import extract_person_features
features = extract_person_features(frame, bbox)
print(features)

# æµ‹è¯•æ‰€æœ‰æƒæ¨¡å—
from ownership import update_luggage_state
state, text, dist, pid = update_luggage_state(...)
```

### 3. æ·»åŠ è°ƒè¯•æ—¥å¿—
åœ¨éœ€è¦çš„åœ°æ–¹æ·»åŠ ï¼š
```python
print(f"[DEBUG] å˜é‡å: {å˜é‡å€¼}")
```

## ğŸ“Š å…³é”®ç‰¹æ€§

âœ… **è¿ç»­å¸§ç¡®è®¤**: ç‰©ä½“å¿…é¡»è¿ç»­å‡ºç°8å¸§æ‰ç¡®è®¤ï¼ˆè¿‡æ»¤èƒŒæ™¯è¯¯æ£€ï¼‰  
âœ… **äººç‰©é‡è¯†åˆ«**: è¿½è¸ªç¦»å¼€åé‡æ–°è¿›å…¥ç”»é¢çš„äºº  
âœ… **åŠ¨æ€è·ç¦»é˜ˆå€¼**: æ ¹æ®äººç‰©å¤§å°è‡ªåŠ¨è°ƒæ•´è·ç¦»åˆ¤æ–­  
âœ… **è¡Œææ‰€æœ‰æƒè¿½è¸ª**: æ£€æµ‹é—å¼ƒã€ç›—å–ã€å¤å–è¡Œä¸º  
âœ… **è®°å¿†å¹³æ»‘**: çŸ­æš‚ä¸¢å¤±çš„ç‰©ä½“ç»§ç»­è¿½è¸ª  

## âš™ï¸ æ€§èƒ½ä¼˜åŒ–

- æ¨¡å—åŒ–åæ¯ä¸ªæ–‡ä»¶ç‹¬ç«‹ï¼Œä¾¿äºä¼˜åŒ–
- å¯ä»¥é€‰æ‹©æ€§å¯¼å…¥éœ€è¦çš„æ¨¡å—
- æ–¹ä¾¿è¿›è¡Œå•å…ƒæµ‹è¯•å’Œæ€§èƒ½åˆ†æ

## ğŸ› å¸¸è§é—®é¢˜

### Q: å¦‚ä½•åˆ‡æ¢è§†é¢‘ï¼Ÿ
A: ç¼–è¾‘ `config.py` ä¸­çš„ `VIDEO_PATH`

### Q: å¦‚ä½•è°ƒæ•´è¿‡æ»¤å¼ºåº¦ï¼Ÿ
A: ç¼–è¾‘ `config.py` ä¸­çš„ `MIN_CONSECUTIVE_FRAMES` (å½“å‰8å¸§)

### Q: å¦‚ä½•å…³é—­Re-IDåŠŸèƒ½ï¼Ÿ
A: åœ¨ `main.py` ä¸­æ³¨é‡Šæ‰ `update_person_features_and_mapping()` è°ƒç”¨

## ğŸ“ˆ åç»­æ”¹è¿›æ–¹å‘

1. æ·»åŠ å•å…ƒæµ‹è¯•ï¼ˆæ¯ä¸ªæ¨¡å—ç‹¬ç«‹æµ‹è¯•ï¼‰
2. ä½¿ç”¨æ—¥å¿—ç³»ç»Ÿæ›¿ä»£print
3. æ·»åŠ å‘½ä»¤è¡Œå‚æ•°æ”¯æŒ
4. æ€§èƒ½åˆ†æå·¥å…·é›†æˆ
5. å¯è§†åŒ–è°ƒè¯•ç•Œé¢
